<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - Home</title>
</head>
<body>
    
    <h1> Root Chat Beta 1.0 </h1>

<style> 
body{
    background-color: blueviolet;

};

#chatbox{ height: 400px; 
    width: 350px; 
    overflow-y: auto; 
    border: 1px solid #ddd; 
    border-radius: 12px; 
    padding: 10px; 
    margin: 50px auto; 
    background-color: #f9f9f9;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
};

.user-menu { display:flex; align-items:center; gap:10px; };
.username { font-size:1rem; font-weight:500; };
.user-avatar { width:35px; height:35px; border-radius:50%; background: var(--btn-cta-start); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:0.9rem; }






</style>

        <!-- Local caixa da mensagem -->
    <div id="chatBox" style="height: 400px; 
    width: 350px; 
    overflow-y: auto; 
    border: 1px solid #ddd; 
    border-radius: 12px; 
    padding: 10px; 
    margin: 50px auto; 
    background-color: #f9f9f9;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);"></div>

<!-- local do texto -->
    <input id="mensagem" type="text" placeholder="Digite sua mensagem..." style="flex: 1;
      height: 40px; 
      padding: 10px 15px;
      border: 1px solid #ccc; 
      border-radius: 20px; 
      outline: none;
      font-size: 14px;
      transition: border 0.2s;
      background-color: #fff;">

<!-- Local do bot√£o de enviar  -->
    <button style="padding: 0 20px;
    border: none;
    border-radius: 20px;
    background-color: #007bff;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;" id="sendBtn">Enviar</button>


<div class="user-menu">
    <span class="username">Ol√°, Usu√°rio</span>
    <button class="menu-icon" id="openThemePanel">‚ãÆ</button>
</div>



    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"> </script>
    <script>
 const socket = io("https://root-backend-chat.onrender.com");

// Recupera os dados do usu√°rio logado
const userId = localStorage.getItem("userId");
const userName = localStorage.getItem("userName");

if (!userId || !userName) {
  alert("‚ö†Ô∏è Voc√™ precisa estar logado para acessar o chat!");
  window.location.href = "../Login-Folder/Login.html";
}

document.querySelector(".username").textContent = `Ol√°, ${userName}`;

socket.on("connect", () => {
  console.log("üü¢ Conectado ao servidor via socket");
});

socket.on("novaMensagem", (msg) => {
  console.log("üì© Nova mensagem recebida:", msg);
  const elem = document.createElement("div");
  elem.textContent = `Usu√°rio ${msg.userId}: ${msg.content}`;
  document.getElementById("chatBox").appendChild(elem);
});

async function sendMessageToServer(userId, content) {
  console.log("üì§ Enviando para o servidor:", { userId, content });
  const res = await fetch("https://root-backend-chat.onrender.com/messages/send", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, content })
  });
  return res.json();
}

document.getElementById("sendBtn").addEventListener("click", async () => {
  const content = document.getElementById("mensagem").value.trim();
  if (!content) return;

  await sendMessageToServer(userId, content);
  document.getElementById("mensagem").value = "";
});

    </script>





</body>
</html>